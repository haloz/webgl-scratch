  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="webgl-debug.js"></script>
  <script src="gl-matrix.1.3.7.min.js"></script>
  <script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    
    void main() {
      gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0); // * 
    }          
  </script>
  <script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;
    void main() {
      gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }           
  </script>
  <script>    
    $(document).ready(function() {
      "use strict";      
      
      var loadShaderFromDOM = function(env, id) {
        var shaderNode = $("#"+id);
        if(!shaderNode) {
          return null; 
        }
        var shader = env.gl.createShader(
          shaderNode.attr("type") == "x-shader/x-vertex" ? env.gl.VERTEX_SHADER : env.gl.FRAGMENT_SHADER
        );
        env.gl.shaderSource(shader, shaderNode.text());
        env.gl.compileShader(shader);
        
        if(!env.gl.getShaderParameter(shader, env.gl.COMPILE_STATUS)) {
          alert(env.gl.getShaderInfoLog(shader));
        }
        return shader;
      };
      
      var setupShaders = function(env) {
        var vertexShader = loadShaderFromDOM(env, "shader-vs"),
            fragmentShader = loadShaderFromDOM(env, "shader-fs");
        
        env.shaderProgram = env.gl.createProgram();
        env.gl.attachShader(env.shaderProgram, vertexShader);
        env.gl.attachShader(env.shaderProgram, fragmentShader);
        env.gl.linkProgram(env.shaderProgram);
        
        if(!env.gl.getProgramParameter(env.shaderProgram, env.gl.LINK_STATUS)) {
          alert("Failed to setup shaders");
        }
        
        env.gl.useProgram(env.shaderProgram);
        env.shaderProgram.vertexPositionAttribute = env.gl.getAttribLocation(env.shaderProgram, "aVertexPosition");

        var modelViewMatrix = mat4.create();
        mat4.identity(modelViewMatrix);
        //mat4.translate(modelViewMatrix, [1.0, 2.0, -10.0], modelViewMatrix);
        mat4.lookAt([3.0, 4.0, -10.0], [0.0, 0.0, 0.0], [0.0, 1.0, 0.0], modelViewMatrix);
        env.gl.uniformMatrix4fv(          
          env.gl.getUniformLocation(env.shaderProgram, "uMVMatrix"),
          false,
          modelViewMatrix
        );
        
        var projectionMatrix = mat4.create();        
        mat4.perspective(
          45, 
          env.gl.viewportWidth / env.gl.viewportHeight,
          1.0,
          10000.0,
          projectionMatrix
        );                
        env.gl.uniformMatrix4fv(
          env.gl.getUniformLocation(env.shaderProgram, "uPMatrix"), 
          false, 
          projectionMatrix
        );
      };
      
              
      var startup = function(env) {
        env.canvas = document.getElementById("simplecanvas");
        env.gl = WebGLDebugUtils.makeDebugContext(createGLContext(env.canvas));
        
        setupShaders(env);
        setupBuffers(env);
        
        /*
        env.gl.frontFace(env.gl.CCW);
        env.gl.enable(env.gl.CULL_FACE);
        env.gl.cullFace(env.gl.BACK);
        */
        
        env.gl.clearColor(0.0, 1.0, 0.0, 1.0);
      };
      
      var draw = function(env) {
        /*
        var zoom = 4.0;
        env.gl.viewport(
          env.gl.viewportWidth/zoom/1.0, 
          env.gl.viewportHeight/zoom/1.0, 
          env.gl.viewportWidth/zoom, 
          env.gl.viewportHeight/zoom
        );
        */
        
        
        //env.gl.viewport(0, 0, env.gl.viewportWidth/2.0, env.gl.viewportHeight/2.0);
        env.gl.clear(env.gl.COLOR_BUFFER_BIT);
        env.gl.vertexAttribPointer(
          env.shaderProgram.vertexPositionAttribute, 
          env.vertexBuffer.itemSize, 
          env.gl.FLOAT,
          false,
          0,
          0
        );
        env.gl.enableVertexAttribArray(env.shaderProgram.vertexPositionAttribute);
        env.gl.drawArrays(env.gl.TRIANGLE_STRIP, 0, env.vertexBuffer.numberOfItems);
      };
      
      var environment = { 
        gl : undefined,
        canvas : undefined,
        shaderProgram : undefined,
        vertexBuffer : undefined
      };
          
      startup(environment);
      console.debug("environment", environment);
      
      draw(environment);
      
    });
  </script>
</head>
<body>
	<canvas id="simplecanvas" width="500" height="500"></canvas>
</body>
</html>
